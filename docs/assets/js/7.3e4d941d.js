(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{267:function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAigAAADNCAYAAACSG4udAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABEUSURBVHhe7d1BqxtZegbg/Br/Dv+INoShF72I6RBoO3ADWWThdBvCgBchi0k7WSQ0SSCZsemQgXEgm3ay8tCrbnxhwAnMruPGl1k5vVP6k+/pPpaqro6uparvqJ4HDroqSWX5nE9Vr06VpN9bAQAkI6AAAOkIKABAOgIKAJCOgAIApCOgAADpCCgAQDoCCgCQjoACAKQjoAAA6QgoAEA6AgoAkI6AAgCkI6AAAOkIKABAOgIKAJCOgAIApCOgAADpCCgAQDoCCgCQjoACAKQjoAAA6QgoAEA6AgoAkI6AAgCkI6AAAOkIKABAOgIKAJCOgAIApNN1QHn0+PG6fXT37ur3f/IT7R1b9GO0Tx8+XH3x9OllL3MIavWwTa0en5o9bFOz++syoDw/P/eimaBFH8cGiutTq9M0tXo4anaapmZ36y6gxIDWA/yLR4/WLyje3cuXL9d9GX1ab6C8iK5nqFbP1epBqNXjsH09npfffqtm99RVQKlfPDHIHE/sAOr+9iLaj1qdTmz4o4/V6rtRs9OJ7aua3a2bgBLJswymRD+deCGVfnfctI1anYdavT41O48I12p2XDcBpUyJGcTpRZ9H38cYsJtanY9avR41Ox81O66LgFIGMBrTi3emZQPm3dXV1Oq81Or+1Oy81Oy4LgJKfCwrBk+6n0/ZiH1y//7lEoao1fmp1f2o2fmp2WFdBJSSLiNpMo9yjNo05NXU6vzU6n7U7PzU7LAuAkoMnBfQvKLvvYB2U6vzU6v7UbPzU7PDugoozMs47KaPcjAO7fRVDsZhm4BCM+Owmz7KwTi001c5GIdtAgrNjMNu+igH49BOX+VgHLYJKDQzDrvpoxyMQzt9lYNx2Cag0Mw47KaPcjAO7fRVDsZhm4BCM+Owmz7KwTi001c5GIdtAgrNjMNu+igH49BOX+VgHLYJKDQzDrvpoxyMQzt9lYNx2Cag0Mw47KaPcjAO7fRVDsZhm4BCM+Owmz7KwTi001c5GIdtAgrNljwO//27364u/u93l9fGTdFHFxcXq9u3b69evHhxueS44t+Jfy/+3devX6/Ozs5Wz549u7w1pyXX6r70VQ7GYZuAQrOljkMEkz/9r79Y/fTXP1v9x2//88qgMkUfCSi7LbVWr+OU++rRo0erBw8eXF7LTc1uE1BottRxiEDy89/8ch1SdgWVKfpIQNltqbV6HafcVwJK3wQUmi19HFqCyhR9VALKkydPVjdv3lzduHFjdevWrfXyUEJELN+8bddjQ/wdy8rjP/vssysDSuwEhv6tuE/c9969e+vbpgw1S6/VfWToq1JXUWtRl/F3LNusxaFaroN6qbl4bAST8ri6/jbXGfUbxp7DVNTsNgGFZmUc/uarf3yrPdy4PuWyu//yZ5O3s199/ENIiXb2qz9f/eFf/vHq/Q8/mKRWywa2bEDLhrW8U4wNdgSQUG4rG+Fdjy23l415ub3sGMr1cnust6yrXC/rivvUO4YpTTEOpyJDX5W6qmup1GKp3VDXW9x+VUAJdT2Gzfqu1zH0HKakZrcJKDQr41DvnLUf2x98/EeT1GrLhrlWb6R3PXZoPXHfeEw8tmzE437130XcJ5bF5VXP6djKOHxy//66ffrw4eqvv29xWbd62S++76dd7YunT3e25+fnTe3ly5dXtqlMUbO7DNXSUP3U9burlsNmQBlaZ9wn2tBzmFKGcchGQKFZGYf4REvd/mfj+lTL/v7f/mH1wZ/cXv3d95dl2bH/3S+/+Wr1t1/901vBZH2Y57s3h3mmqNWWDXNslMsUdrTWgLK5QQ9jASWux7vR+t+JFtPj8ZihncFUyjicevvo7t037c6dH/8eWFaC2seXl3Ur65rTUDgYqsXN+ts3oMT1zXqNFvcZeg5TyjAO2QgoNMs2DvGONp5PXB5bnGcSQWQrmGycKDtFH+3aMMfGNjbERb2R3vXYzQ18iGVDh3ji7zi/pF5XbWhdUynjUGYrYmbj6cZMx+ayeqZkrNWzL2NtMwCMtbfCxEAr/4ep2pzquiqG6qeuuesElLi9vl4beg5TyjAO2QgoNMs2DrHDiOcTl8cUIWRXMCmm6KOrNsyvXr16ayNbNrqtASWWxwzI5uNbz0Gp1eudWrZaPZYfDgl9++1bh4c2l5Wgdn55WbcMfbVZVyHq7apzUMpjyu3l/nXNbQaUcp/63ymGnsOUllKz+xBQaJZtHKYMKHFS7lXBpJiij3aFjPi7TF1H2Ih3nK0BJZSQUh4fJ9zGY+KxQxvxWHf596KVf2tzvVPKVquZZeirsXBQAkWprc16qms17he1Wt+nfnxZd/2YaPF3LBt7DlNRs9sEFJplG4epAso+1GoOxqGdvsrBOGwTUGiWbRwEFMYYh1w/z8BuxmGbgEKzbOMgoDBm6eNQzpvK8vMM7GYctgkoNMs2DgIKY5Y+DhFIMv08A7sZh20CCs2yjYOAwhjj8EZLUNFXORiHbQIKzbKNg4DCmDIOmz+NUF9f0rIIJiWkbAYVNZuDcdgmoNAs2zgIKIwp41DvlLXtFt+MrGZzMA7bBBSaZRsHAYUxZRzqnyk49s8gZF0WISRmUepgUh/mUbM5GIdtAgrNso2DgMIY4/Dm/JMIImPBpNBXORiHbQIKzbKNg4DCmKWPQ4SQXcGkULM5GIdtAgrNso1D5oASv3/CfLLV6tQijMRhnauCSaFmc1h6zQ4RUGiWbRwyBpTyK7TxI2zMo/wAXowFu6nZ+anZYQIKzbKNQ8aAEj+jn+05Lc0XT5+ux+DThw8vl3AVNTs/NTtMQKFZtnHIGFC8E5pfmRGIjT67qdn5qdlhAgrNso1DxoASx/G9I51PeSdqZ9tOzc5LzY4TUK5wcXGxunXr1urGjRvrFn/HsqWaaxzGZAwo4YcNzp07jutPqMwERNPv+6l3kvpuOmr2agLKiBcvXqzee++99WXx9ddfv3V9aeYYh6tkDSjh0ePH6+cWG3zvSo+v1EK06Hv2p2anpWZ3E1BGPHv2bHV2drZ6/fr15RLmGIerlBd4xo1pTJuXDX60stH3Lukwon+j1Rv5aDb016dmj0vN7k9AGTE0g7Lp0feFNnT4p4Sbe/furW/7/PPPV7dv337r8FCst17Wuq64Ppc5xuEq5YUel1nF1Hls6Evfacdp0cd2pIdRavb9Dz8Y7GvtME3N7iagXCHCQISCoZmUCBT18rj+4MGD9d/lcSVMxH3ivnW4iPvGY8I+65pT/eLK1DIHlBDvmmKjHx8hFFYO06Ifo8W7T+9AD+9fz/99/Q20D/75r9TsgZqa3Z+A0iACQ4SEEiiGAkfMeMSyuIzldeAIdeiI+8TsScyiXGddc6lfbJla9oACvdj87Z74NlqYi4DSKMJCHHqJwFD+jtBSt5s3b65Dx1Co2AwddVjZd11zyTAOtR4O8UAPNoPJT3/9s/UvIcOcBJQ9lMMyERbinJCx81PGQkU8voSTuAzXXdccBBQ4HfEbPUPB5Mtvvrq8B8xLQBkRwaCEiFDPoIQIKmPBYSxUlOXRYn3FddY1BwEF+ieY0AsBZUTMaMRhlvqwSx1YQsyE1LeXwzZjoaKEnHIuS23fdc1BQIF+RSiJILIVTP5XMCEnAYVmAgr0ZWy2JJbFbZCZgEIzAQX6EIdrfv6bXw4GE+iFgEIzAQXyGpotiWa2hF4JKDQTUCCXEkqGzi0xW0LvBBSaCSiQQ4SPsUM4Zks4FQIKzQQUmM/YIZwIKj6JwykSUGgmoMC0xkKJQzgsgYBCMwEFjm/XeSUX3zmEwzIIKDQTUOA4doYS55WwQAIKzQQUOJwSSuIXg4dCiR/rY+kEFJoJKPBuSijZ/AROtFju93DgRwIKzQQUuJ4STDZDSZktAbYJKDQTUKCdUALvRkChmYACVyuhZOxkV6CdgEIzAQW27TrZ1ceC4XoEFJoJKPCjoUM4JZT4BA68OwGFZgIKS+cQDkxHQKGZgMJSxcd//TgfTEtAoZmAwpIMHcKJFst8Xwkcn4BCMwGFJYhgMjZbAkxHQKGZgMIpiwCyeW5JBBUnvMI8BBSaCSicmqs+iQPMS0ChmYDCqRBMID8BhWYCCr0bCibxBWuxHMhFQKGZgEKvhk58jaDiW14hLwGFZgIKvRkNJmZMID0BhWYCCr0YOpTj/BLoi4BCMwGFHggmcBoEFJoJKGQW31dSf4+Jk1+hbwIKzQQUMooQEmGkBJMIKb5cDfonoNBMQCGbCCIlmERzOAdOh4BCMwGFLDY/neNwDpweAYVmAgoZmDWBZRBQaCagMLcvv/nKrAkshIBCMwGFOdWHdMyawOnrKqC8fPnycglzEFCYS/0pHZ/QgWXoIqB8dPfuekf0/Pz8cglTi76PMYixyEJAOX31R4h9fBiWpYuA8sn9+3ZEM/vi6dP1GHz68OHlkvkJKKdPOIHl6iKgZHz3vjRlFiuCShYCymkr4SQugeXpIqDEuSdmUeZTZk+yBUQB5XSV39OJmROf1IFl6iKghHon+fz588ulHFuZvYqW7RwgAeU01d9z4rAOLFc3ASU8evz4TUi5c8dOaQIlAESLvs9GQDk9wglQdBVQ4lBPCSnroHL37nrn5NM9hxH9G60OJtEyhpMgoJyect5JfOcJsGxdBZQiDveUkza147X14bTE4U9AOS31t8QCdBlQQrzTj6ASH3sVVg7Toh+jxYxJ1lmTmoDSr6ETX8vsiW+JBUK3AQUElD6Vr6yPGZOiPvckmo8WAwIK3RJQ+lQO5cRHiIsye1JaHV6AZRJQ6JaA0qeL7378+voSROpwUgcXYLkEFLoloPSrnkUpf5dm9gQIAgrdElD6Vf8IYH14x+wJUAgodEtA6dvmzEk0sydAIaDQLQGlb/UsSjSzJ0BNQKFbAkr/6lkUsydATUChWwJK/8ositkTYJOAQrcElNMQMydmT4BNAgrdyhhQ4vlo+7X3P/xgcLm2u8EpE1DoloCiLb3BKRNQ6FbmgALHpM5YAgGFbgkoLJU6YwkEFLoloLBU6owlEFDoloDCUqkzlkBAoVsCCkulzlgCAYVuCSgslTpjCQQUuiWgsFTqjCUQUOiWgMJSqTOWQEChWwIKS6XOWAIBhW4JKCyVOmMJBBS6JaD058WLF6ubN2+uW/zN9agzlkBAoVsCSl9ev369Ojs7Wz179uxyCdelzlgCAYVuCSh9ubi4WN2+fdvMyQGoM5ZAQKFbAko/yqGdGzdurFvMpLx69Wp9+eTJk9WtW7fWyzcP/ZRZl/pxsWzp1BlLIKDQrRJQMja2bc6glPAR4SRuCw8ePPghhJTbH1UBNMKMgCKgsAwCCt06Pz9/KxRkamwbCyj1OSlxW9wn7hvLzZgMU2csgYACB2THMW7fgBIzJzGjwjZ1xhIIKHBAdhzjzKAcjjpjCQQUOCA7jnH7BpRocX6Kc1C2qTOWQECBA7LjGLdvQAklpJRP8Tjk84Y6YwkEFDggOw6moM5YAgEFDsiOgymoM5ZAQIEDsuNgCuqMJRBQ4IDsOJiCOmMJBBQ4IDsOpqDOWAIBBQ7IjoMpqDOWQECBA7LjYArqjCUQUOCA7DiYgjpjCQQUOCA7DqagzlgCAQUOyI6DKagzlkBAgQMqOw5Nm6LBKRNQ4ICGdiKadqwGp0xAAQDSEVAAgHQEFAAgHQEFAEhHQAEA0hFQAIB0BBQAIB0BBQBIR0ABANIRUACAdAQUACAdAQUASEdAAQDSEVAAgHQEFAAgHQEFAEhHQAEA0hFQAIB0BBQAIB0BBQBIR0ABANIRUACAdAQUACAdAQUASEdAAQDSEVAAgHQEFAAgHQEFAEhHQAEA0hFQAIB0BBQAIB0BBQBIZrX6f3Fb8RH7eimRAAAAAElFTkSuQmCC"},300:function(t,s,n){"use strict";n.r(s);var a=n(13),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"微型-web-框架"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微型-web-框架"}},[t._v("#")]),t._v(" 微型 WEB 框架")]),t._v(" "),s("p",[t._v("本文我们将尝试基于 "),s("code",[t._v("net/http")]),t._v(" 库开发一个简单的 WEB 框架，开始之前你需要了解"),s("code",[t._v("net/http")]),t._v(" 库的基本用法("),s("RouterLink",{attrs:{to:"/packages/http.html"}},[t._v("你可以点击此处跳转")]),t._v(")。")],1),t._v(" "),s("h2",{attrs:{id:"完整代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#完整代码"}},[t._v("#")]),t._v(" 完整代码")]),t._v(" "),s("p",[t._v("本文的完整代码可以在此仓库查看"),s("a",{attrs:{href:"https://github.com/Bluesgavin/go-web",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Bluesgavin/go-web"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"基础实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础实现"}},[t._v("#")]),t._v(" 基础实现")]),t._v(" "),s("p",[t._v("假如我们现在有一个业务常见，需要启动一个 Web 应用，可以实现图书仓库的增删改查接口。假如使用 "),s("code",[t._v("net/http")]),t._v(" 基础库，代码的轮廓大致如下：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("home")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fprintf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HOME PAGE"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fprintf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ADD A BOOK!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fprintf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET A BOOK!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fprintf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE A BOOK!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fprintf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE A BOOK!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 主页")]),t._v("\n\thttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleFunc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" home"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新增图书")]),t._v("\n\thttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleFunc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/book/add"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addBook"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查找图书")]),t._v("\n\thttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleFunc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/book/get"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getBook"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除图书")]),t._v("\n\thttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleFunc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/book/delete"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" deleteBook"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新图书")]),t._v("\n\thttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleFunc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/book/update"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" updateBook"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListenAndServe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('":8081"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("panic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"server started!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"第一次框架设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一次框架设计"}},[t._v("#")]),t._v(" 第一次框架设计")]),t._v(" "),s("p",[t._v("根据上方代码，我们可以初步给我们的框架定义出三个的模块：")]),t._v(" "),s("ul",[s("li",[t._v("Server：主要负责服务的启动，注册路由")]),t._v(" "),s("li",[t._v("Handler：负责多种回调函数的封装")]),t._v(" "),s("li",[t._v("Context：负责封装处理请求内容")])]),t._v(" "),s("h4",{attrs:{id:"context模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#context模块"}},[t._v("#")]),t._v(" Context模块")]),t._v(" "),s("p",[t._v("由此我们可以先确定 Context 的内容")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Context "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tW http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter\n\tR "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 覆盖上方代码中的常用响应")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("respond")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fprintf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("W"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用于创建新 Context 实例")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("W http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" R "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Context "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tW"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" W"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" R"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"handler模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#handler模块"}},[t._v("#")]),t._v(" Handler模块")]),t._v(" "),s("p",[t._v("目前看来 Handler 并没有功能，但把通过封装自定义类型，可以省略大量回调函数相关的代码。")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" HandlerFunc "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"server模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server模块"}},[t._v("#")]),t._v(" Server模块")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Server "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动服务")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("address "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListenAndServe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("address"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册路由")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pattern "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handlerFn HandlerFunc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\thttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleFunc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pattern"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("writer http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tctx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handlerFn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用于创建新 Server 实例")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("Server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"更新代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新代码"}},[t._v("#")]),t._v(" 更新代码")]),t._v(" "),s("p",[t._v("有了我们的定义模块之后，我们可以把开头的代码修改为：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("home")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Respond")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HOME PAGE"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Respond")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ADD A BOOK!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Respond")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET A BOOK!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Respond")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE A BOOK!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteBook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Respond")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE A BOOK!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tserver "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 主页")]),t._v("\n\tserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" home"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新增图书")]),t._v("\n\tserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/book/add"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addBook"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查找图书")]),t._v("\n\tserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/book/get"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getBook"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除图书")]),t._v("\n\tserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/book/delete"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" deleteBook"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新图书")]),t._v("\n\tserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/book/update"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" updateBook"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListenAndServe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('":8081"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("panic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"server started!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"二次优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二次优化"}},[t._v("#")]),t._v(" 二次优化")]),t._v(" "),s("p",[t._v("目前为止，我们只是简单地把代码封装了一下。但我们的框架功能不能仅仅如此，还需要考虑：")]),t._v(" "),s("ol",[s("li",[t._v("支持POST，PUT，DELETE等其他请求方式。")]),t._v(" "),s("li",[t._v("支持中间件功能")]),t._v(" "),s("li",[t._v("路由优化,采用路由树管理路由")]),t._v(" "),s("li",[t._v("支持通用路由——"),s("code",[t._v("*")])])]),t._v(" "),s("h4",{attrs:{id:"中间件效果设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#中间件效果设计"}},[t._v("#")]),t._v(" 中间件效果设计")]),t._v(" "),s("p",[t._v("这里的中间件指的是像 "),s("code",[t._v("eggJs")]),t._v(" 一样的洋葱模型中间件效果。这里使用闭包设计，把函数层层嵌套实现最终效果。")]),t._v(" "),s("h4",{attrs:{id:"路由设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由设计"}},[t._v("#")]),t._v(" 路由设计")]),t._v(" "),s("p",[t._v("我们加入一个新的 "),s("code",[t._v("Router")]),t._v(" 模块,主要负责路由的定于与查找。这里我们可以用 “树状” 结构实现。")]),t._v(" "),s("h4",{attrs:{id:"通用路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通用路由"}},[t._v("#")]),t._v(" 通用路由")]),t._v(" "),s("p",[t._v("有时候，我们需要配置通用路由，格式为"),s("code",[t._v("book/*")]),t._v("。这种路由可以触发 book下的所以子路由函数。要实现这种效果，我们需要在路由的搜索上作节点类型的判断。")]),t._v(" "),s("h4",{attrs:{id:"整体思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整体思路"}},[t._v("#")]),t._v(" 整体思路")]),t._v(" "),s("p",[t._v("综上考虑，我们可以得出我们的设计模型："),s("br"),t._v(" "),s("img",{attrs:{src:n(267),alt:"showcase"}}),s("br"),t._v("\n框架暴露一个 "),s("code",[t._v("Server")]),t._v(" 模块，"),s("code",[t._v("Server")]),t._v(" 下有 "),s("code",[t._v("handler")]),t._v(" 和 "),s("code",[t._v("fnc")]),t._v(" 。其中 "),s("code",[t._v("fnc")]),t._v(" 是通过中间件封装后的执行函数。在图中绿色线为请求的执行路径，"),s("code",[t._v("Server")]),t._v(" 接收到请求后会交给 "),s("code",[t._v("handler")]),t._v(" 处理，而 "),s("code",[t._v("handler")]),t._v(" 下有一个 router 模块，它会判断请求的 "),s("code",[t._v("url")]),t._v(" 和 "),s("code",[t._v("method")]),t._v(" ，如果找到对应注册过的函数，就会生成一个新的 "),s("code",[t._v("Context")]),t._v(" 并带入 "),s("code",[t._v("fnc")]),t._v(" 中执行。")])])}),[],!1,null,null,null);s.default=e.exports}}]);